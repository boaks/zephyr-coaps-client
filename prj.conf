#
# Copyright (c) 2022 Achim Kraus CloudCoap.net
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Eclipse Public License 2.0 which is available at
# http://www.eclipse.org/legal/epl-2.0
#
# SPDX-License-Identifier: EPL-2.0
#

# Application version, requires CONFIG_BOOTLOADER_MCUBOOT
# Before NCS 2.5.0
# CONFIG_MCUBOOT_IMAGE_VERSION="0.9.99+0"
# Since NCS 2.5.0 the VERSION file provides that information 

# General config
CONFIG_NEWLIB_LIBC=y
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y
CONFIG_NCS_SAMPLES_DEFAULTS=y
CONFIG_FPU=y

# FLASH
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_STREAM_FLASH=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y
CONFIG_IMG_ERASE_PROGRESSIVELY=y

CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=n

# Settings
CONFIG_SETTINGS=y
CONFIG_SETTINGS_NVS=y
CONFIG_NVS=y
CONFIG_SETTINGS_RUNTIME=y
CONFIG_BASE64=y

# CONFIG_STACK_CANARIES=y
# CONFIG_USERSPACE=y
CONFIG_DEBUG_THREAD_INFO=y

# Heap and stacks
CONFIG_MAIN_STACK_SIZE=6000
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

CONFIG_REBOOT=y
CONFIG_HWINFO=y
CONFIG_PM_DEVICE=y

CONFIG_WATCHDOG=y
CONFIG_WDT_DISABLE_AT_BOOT=n

# Logging
CONFIG_LOG=y
CONFIG_LOG_MODE_DEFERRED=y
#CONFIG_LOG_MODE_IMMEDIATE=y

#CONFIG_USE_SEGGER_RTT=y
#CONFIG_LOG_BACKEND_RTT=y
#CONFIG_LOG_BACKEND_FORMAT_TIMESTAMP=y

CONFIG_TFM_LOG_LEVEL_SILENCE=n
CONFIG_TFM_SPM_LOG_LEVEL_DEBUG=y
CONFIG_TFM_EXCEPTION_INFO_DUMP=y
CONFIG_TFM_SECURE_UART_SHARE_INSTANCE=y
CONFIG_TFM_SECURE_UART0=y


# Use UART in async mode (DMA)
CONFIG_UART_ASYNC_API=y
CONFIG_UART_0_ASYNC=y
CONFIG_UART_0_NRF_HW_ASYNC=y
CONFIG_UART_0_NRF_HW_ASYNC_TIMER=2
CONFIG_NRFX_TIMER2=y

# Network
CONFIG_NETWORKING=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_NET_NATIVE=n
#CONFIG_NET_SOCKETS_OFFLOAD_TLS=y

CONFIG_MODEM_KEY_MGMT=y

# LTE link control
CONFIG_LTE_LINK_CONTROL=y
# Removed in NCS 2.6.0
# CONFIG_LTE_AUTO_INIT_AND_CONNECT=n
CONFIG_MODEM_INFO=y

# Uncomment for tracing or 
# enable it via cli "-DCONFIG_NRF_MODEM_LIB_TRACE=y"
# CONFIG_NRF_MODEM_LIB_TRACE=y

# Modem library
CONFIG_NRF_MODEM_LIB=y
CONFIG_NRF_MODEM_LIB_ON_FAULT_APPLICATION_SPECIFIC=y

# LTE parameters
## Network Mode / LTE category
#CONFIG_LTE_NETWORK_MODE_NBIOT=y
#CONFIG_LTE_NETWORK_MODE_LTE_M=y
#CONFIG_LTE_NETWORK_MODE_LTE_M_NBIOT=y
CONFIG_LTE_NETWORK_MODE_LTE_M_NBIOT_GPS=y
CONFIG_LTE_MODE_PREFERENCE_AUTO=y
#CONFIG_LTE_MODE_PREFERENCE_LTE_M=y
#CONFIG_LTE_MODE_PREFERENCE_NBIOT=y
#CONFIG_LTE_MODE_PREFERENCE_LTE_M_PLMN_PRIO=y
#CONFIG_LTE_MODE_PREFERENCE_NBIOT_PLMN_PRIO=y
CONFIG_LTE_LC_MODEM_SLEEP_NOTIFICATIONS=y
CONFIG_LTE_LINK_CONTROL_LOG_LEVEL_INF=y
CONFIG_LTE_LC_MODEM_SLEEP_NOTIFICATIONS_THRESHOLD_MS=60000
CONFIG_AT_MONITOR=y
#CONFIG_LTE_POWER_ON_OFF_CONFIG_SWITCH=y

## PSM
CONFIG_UDP_PSM_ENABLE=y
# 001xxxxx : hours
# CONFIG_LTE_PSM_REQ_RPTAU="00100100"
# CONFIG_LTE_PSM_REQ_RPTAU="00100001"
# CONFIG_LTE_PSM_REQ_RPTAU="00101000"
# 24h
CONFIG_LTE_PSM_REQ_RPTAU="00111000"
# 101xxxxx : minutes
# CONFIG_LTE_PSM_REQ_RPTAU="10100100"
# 000xxxxx : 10 minutes
# CONFIG_LTE_PSM_REQ_RPTAU="00000001"

# CONFIG_LTE_PSM_REQ_RAT is overwritten in modem.c 
CONFIG_LTE_PSM_REQ_RAT="00000000"

## RAI
CONFIG_AS_RAI_ON=y
# CONFIG_CP_RAI_ON=y

## eDRX
CONFIG_UDP_EDRX_ENABLE=n
#CONFIG_LTE_EDRX_REQ=n
# 655,36 seconds
#CONFIG_LTE_EDRX_REQ_VALUE_LTE_M="1011"
#CONFIG_LTE_EDRX_REQ_VALUE_NBIOT="1011"
#CONFIG_LTE_PTW_VALUE_LTE_M="1111"
#CONFIG_LTE_PTW_VALUE_NBIOT="1001"
# 163.84 seconds
#CONFIG_LTE_EDRX_REQ_VALUE_LTE_M="1001"
#CONFIG_LTE_EDRX_REQ_VALUE_NBIOT="1001"
# 81.92 seconds
#CONFIG_LTE_EDRX_REQ_VALUE_LTE_M="0101"
#CONFIG_LTE_EDRX_REQ_VALUE_NBIOT="0101"
# 40.96 seconds
#CONFIG_LTE_EDRX_REQ_VALUE_LTE_M="0011"
#CONFIG_LTE_EDRX_REQ_VALUE_NBIOT="0011"
# 20.48 seconds
CONFIG_LTE_EDRX_REQ_VALUE_LTE_M="0010"
CONFIG_LTE_EDRX_REQ_VALUE_NBIOT="0010"

CONFIG_LTE_LOCK_BANDS=n

CONFIG_LTE_LOCK_PLMN=n
# Germany:
# - Telekom: 26201
# - Vodafone: 26202
# - Telefonica: 26203
#CONFIG_LTE_LOCK_PLMN_STRING="26201"

## PDN
CONFIG_PDN=y
CONFIG_PDN_ESM_STRERROR=y
CONFIG_AT_MONITOR_HEAP_SIZE=4096

## SMS
CONFIG_SMS=y
CONFIG_SMS_SUBSCRIBERS_MAX_CNT=2
CONFIG_SMS_LOG_LEVEL_DBG=n

## CoAP
CONFIG_COAP=y

# Logging
CONFIG_COAP_CLIENT_LOG_LEVEL_INF=y
CONFIG_UI_LOG_LEVEL_INF=y
CONFIG_STORAGE_LOG_LEVEL_INF=y

# TinyDtls
CONFIG_LIBTINYDTLS=y
CONFIG_LIBTINYDTLS_PSK=y
CONFIG_LIBTINYDTLS_ECDHE_ECDSA=y
CONFIG_TINYDTLS_LOG_LEVEL_INF=y

# External SHT21 temperature sensor
# CONFIG_SHT21=y
# CONFIG_I2C_LOG_LEVEL_OFF=y
